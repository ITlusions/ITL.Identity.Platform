# OAuth2 Proxy Configuration for ITL Identity Platform Documentation
# Save this as: oauth2-proxy.cfg

# Server Configuration
http_address = "0.0.0.0:4180"
upstreams = [ "http://identity-docs:80" ]

# OIDC Provider Settings (Configure these based on your Keycloak setup)
provider = "keycloak-oidc"
provider_display_name = "ITL Identity Platform"
oidc_issuer_url = "https://sso.yourdomain.com/realms/itl-platform"
client_id = "${KEYCLOAK_CLIENT_ID}"
client_secret = "${KEYCLOAK_CLIENT_SECRET}"

# Scopes and Claims
scope = "openid email profile groups"
oidc_groups_claim = "groups"
oidc_email_claim = "email"

# Session Configuration
cookie_secret = "${OAUTH2_PROXY_COOKIE_SECRET}"
cookie_domains = [".yourdomain.com", ".localhost"]
cookie_secure = false  # Set to true in production with HTTPS
cookie_httponly = true
cookie_samesite = "lax"
cookie_expire = "24h"
cookie_refresh = "1h"

# Authorization Rules
email_domains = ["*"]  # Allow all email domains, restrict by groups instead
allowed_groups = ["docs-readers", "developers", "architects", "administrators"]

# Logging
request_logging = true
auth_logging = true
standard_logging = true
silence_ping_logging = true

# Headers to pass to upstream
pass_basic_auth = false
pass_access_token = false
pass_user_headers = true
set_authorization_header = false
set_xauthrequest = true

# Skip authentication for specific paths
skip_auth_regex = [
  "^/health$",
  "^/assets/.*",
  "^/search/.*",
  "^/favicon.ico$"
]

# Custom sign-in page
custom_sign_in_logo = "https://yourdomain.com/logo.png"
footer = "ITL Identity Platform Documentation - Secure Access Required"

# Security headers
response_headers = {
  "X-Frame-Options" = "DENY",
  "X-Content-Type-Options" = "nosniff",
  "X-XSS-Protection" = "1; mode=block",
  "Strict-Transport-Security" = "max-age=31536000; includeSubDomains",
  "Referrer-Policy" = "strict-origin-when-cross-origin"
}

# Reverse proxy settings
reverse_proxy = true
real_client_ip_header = "X-Real-IP"